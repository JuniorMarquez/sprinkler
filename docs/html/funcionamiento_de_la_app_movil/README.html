<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Funcionamiento de la app móvil | Introducción</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../funcionamiento_del_servidor/README.html" />
    
    
    <link rel="prev" href="../fucionamiento_general_del_sistema/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="2" data-basepath=".." data-revision="1435692898313">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introducción
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="fucionamiento_general_del_sistema/README.html">
            
                
                    <a href="../fucionamiento_general_del_sistema/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Fucionamiento general del sistema
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2" data-path="funcionamiento_de_la_app_movil/README.html">
            
                
                    <a href="../funcionamiento_de_la_app_movil/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Funcionamiento de la app móvil
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="funcionamiento_del_servidor/README.html">
            
                
                    <a href="../funcionamiento_del_servidor/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Funcionamiento del servidor
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Introducción</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_6527">
                    
                        <h1 id="funcionamiento-de-la-app-mvil">Funcionamiento de la app móvil</h1>
<p>La aplicación móvil Sprinkler está altamente basada en el proyecto libre <a href="https://github.com/Kickflip/kickflip-android-sdk" target="_blank"><strong>KickFlip</strong></a>, con licencia Apache V2. Esto quiere decir que siempre que se mantenga la autoría original es posible reutilizar esta librería.</p>
<p>Para hacer funcionar el proyecto, KickFlip ha tenido que ser modificado para enviar al servidor HTTP los datos de video en una petición HTTP Chunked en lugar de subirlos junto con su &quot;playlist&quot; a una instancia de Amazon AWS usando la propia API de KickFlip, que ha tenido que ser eliminada a lo largo de toda la librería para mayor comodidad. Aún así, es posible que en la versión modificada aún queden restos de ella que no estén referenciados por ninguna otra parte del código.</p>
<h2 id="componentes-de-la-librera-kickflip-modificada">Componentes de la librería KickFlip (modificada)</h2>
<p>Los principales componentes de la librería son:</p>
<ul>
<li>Encoder: se encarga de recibir los datos de la cámara y pasarlos al formato de video correcto.</li>
<li>Muxer: recoge los datos del encoder y los organiza de forma que puedan ser entendidos por otra aplicación.</li>
<li>Broadcaster: envía los datos tras el muxing a su destino.</li>
</ul>
<p>Estos son interfaces que tienen varias implementaciones reales detrás, de las cuales se acaba usando una u otra dependiendo de la situación.</p>
<p>En este caso, las clases que se usan son:</p>
<ul>
<li>CameraEncoder: gestiona la conexión con la cámara y el encoding de los datos recibidos.</li>
<li>MicrophoneEncoder: igual que <em>CameraEncoder</em>, pero con el micrófono del dispositivo.</li>
<li>FFmpegMuxer: recoge los datos de ambos encoders y los pasa por funciones del código de <em>FFMPEG</em> mediante NDK. En este caso, le pide que dados los streams de video y audio, haga muxing y cree los archivos necesarios para una transmisión mediante <em>HLS</em>. <strong>Sin embargo, FFMPEG no los transmite</strong>.</li>
<li>Broadcaster: internamente contiene un observer que llama a un callback cuando se crea un nuevo archivo <code>.ts</code> en el directorio de grabación. Cuando esto ocurre, el <em>Broadcaster</em> lo añade a una cola y pone a subir el primer archivo de la cola hacia el servidor. Una vez subido, el archivo se elimina para no desperdiciar espacio en disco.</li>
</ul>
<p>El <strong>Broadcaster</strong>, asimismo, lleva un control del ancho de banda disponible para el envío del video, de forma que si detecta que el ancho de banda disponible está muy cercano al necesario para enviar el video, se reduzca el bitrate del mismo, perdiendo calidad pero impidiendo ralentizaciones y cortes en la medida de lo posible.</p>
<p>Aparte de estas, la interfaz está implementada mediante una <strong>BroadcastActivity</strong> que contiene un <strong>BroadcastFragment</strong>, de forma que este fragment es reutilizable.</p>
<p>Todo se configura mediante una instancia <em>Singleton</em> del componente <strong>SessionConfig</strong>, que debe recrearse para cada nueva grabación.</p>
<h2 id="posibles-mejoras">Posibles mejoras</h2>
<p>En un futuro quizás sería posible prescindir del muxing a HLS en local y hacer muxing a FFM, el formato que FFServer necesita. Esto presenta varios problemas:</p>
<ul>
<li>No es seguro que el wrapper de FFMPEG utilizado aquí lo permita, aunque se podría compilar otra versión con soporte.</li>
<li>No existe documentación clara de FFM salvo <a href="http://git.videolan.org/?p=ffmpeg.git;a=blob_plain;f=libavformat/ffm.h;hb=HEAD" target="_blank">su implementación en FFMPEG</a>.</li>
<li>Al no existir dicha documentación, es difícil saber cuándo habría que transmitir nuevos datos, ya que el archivo <code>.ffm</code> no crece de forma desproporcionada, sino que su tamaño varía de forma dinámica.</li>
<li>De esto último podría encargarse el propio FFMPEG del dispositivo, pero no tiene soporte para crear sus propios sockets o conexiones HTTP.</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../fucionamiento_general_del_sistema/README.html" class="navigation navigation-prev " aria-label="Previous page: Fucionamiento general del sistema"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../funcionamiento_del_servidor/README.html" class="navigation navigation-next " aria-label="Next page: Funcionamiento del servidor"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
